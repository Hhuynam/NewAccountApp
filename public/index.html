<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Đăng ký gói cước</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container text-center mt-5">
    <h1 class="text-primary">Đăng ký gói cước tài khoản</h1>
    <p class="lead">Chọn gói phù hợp để thanh toán qua SePay sandbox</p>

    <div class="d-grid gap-3 col-6 mx-auto">
      <button class="btn btn-outline-primary subscribe-btn" data-plan="Basic" data-amount="20000">Basic - 20,000 VND</button>
      <button class="btn btn-outline-success subscribe-btn" data-plan="Premium" data-amount="50000">Premium - 50,000 VND</button>
      <button class="btn btn-outline-warning subscribe-btn" data-plan="VIP" data-amount="100000">VIP - 100,000 VND</button>
    </div>
  </div>

  <script>
    document.querySelectorAll('.subscribe-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        const plan = btn.getAttribute('data-plan');
        const amount = btn.getAttribute('data-amount');

        // Gọi API đăng ký gói cước
        const res = await fetch('/api/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username: 'nam', plan, amount })
        });
        const data = await res.json();

        // Tạo form động và submit sang SePay
        const form = document.createElement('form');
        form.action = data.checkoutURL;
        form.method = 'POST';

        for (const field in data.checkoutFormfields) {
          const input = document.createElement('input');
          input.type = 'hidden';
          input.name = field;
          input.value = data.checkoutFormfields[field];
          form.appendChild(input);
        }

        document.body.appendChild(form);
        form.submit();
      });
    });
  </script>
</body>
</html>